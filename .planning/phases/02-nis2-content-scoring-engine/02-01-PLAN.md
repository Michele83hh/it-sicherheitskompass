---
phase: 02-nis2-content-scoring-engine
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/nis2/types.ts
  - src/lib/nis2/sectors.ts
  - src/lib/nis2/classification.ts
  - src/messages/de.json
  - src/messages/en.json
autonomous: true

must_haves:
  truths:
    - "All 18 NIS2 sector categories (7 Anlage 1 + 7 Anlage 2) exist as structured TypeScript data with German and English translation keys"
    - "Classification function correctly classifies entities as 'besonders-wichtig', 'wichtig', or 'nicht-betroffen' based on sector, employee count, revenue, and balance sheet per §28 BSIG"
    - "Special cases (DNS, TLD, qTSP, KRITIS) are always classified as 'besonders-wichtig' regardless of size"
    - "Each sector has correct Anlage assignment (1 or 2), subsectors where applicable, and legal references"
    - "TypeScript compiles with zero errors"
  artifacts:
    - path: "src/lib/nis2/types.ts"
      provides: "All NIS2 domain types: Sector, Subsector, ClassificationInput, ClassificationResult, EntityCategory"
      exports: ["Sector", "Subsector", "ClassificationInput", "ClassificationResult", "EntityCategory"]
    - path: "src/lib/nis2/sectors.ts"
      provides: "Complete 18-sector catalog with translation keys, Anlage assignments, and subsectors"
      exports: ["SECTORS", "getAllSectors", "getSectorById"]
    - path: "src/lib/nis2/classification.ts"
      provides: "Pure classification function implementing §28 BSIG thresholds"
      exports: ["classifyEntity", "THRESHOLDS"]
    - path: "src/messages/de.json"
      provides: "German translations for all sectors and subsectors"
      contains: "sectors"
    - path: "src/messages/en.json"
      provides: "English translations for all sectors and subsectors"
      contains: "sectors"
  key_links:
    - from: "src/lib/nis2/classification.ts"
      to: "src/lib/nis2/sectors.ts"
      via: "classifyEntity imports SECTORS to look up Anlage assignment"
      pattern: "import.*SECTORS.*from.*sectors"
    - from: "src/lib/nis2/classification.ts"
      to: "src/lib/nis2/types.ts"
      via: "Uses ClassificationInput and ClassificationResult types"
      pattern: "import.*Classification.*from.*types"
    - from: "src/lib/nis2/sectors.ts"
      to: "src/lib/nis2/types.ts"
      via: "Uses Sector and Subsector types"
      pattern: "import.*Sector.*from.*types"
---

<objective>
Create all NIS2 sector data (18 sectors from Anlagen 1 and 2 BSIG) as structured TypeScript const objects with i18n translation keys, plus the pure classification function implementing §28 BSIG thresholds.

Purpose: The sector data and classification logic are the foundation of Step 1 (Betroffenheitsprüfung). Without correct sector data and classification, the entire tool cannot determine NIS2 applicability. This data is also referenced by the scoring engine and PDF report.
Output: Three TypeScript files (types, sectors, classification) with complete sector data and classification logic, plus German and English translations for all sectors and subsectors.
</objective>

<execution_context>
@C:\Users\mjoan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\mjoan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Users\mjoan\Desktop\nis2-readiness-check\.planning\PROJECT.md
@C:\Users\mjoan\Desktop\nis2-readiness-check\.planning\ROADMAP.md
@C:\Users\mjoan\Desktop\nis2-readiness-check\.planning\STATE.md
@C:\Users\mjoan\Desktop\nis2-readiness-check\.planning\phases\02-nis2-content-scoring-engine\02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NIS2 domain types and sector data catalog</name>
  <files>
    src/lib/nis2/types.ts
    src/lib/nis2/sectors.ts
  </files>
  <action>
    1. Create the directory `src/lib/nis2/` if it does not exist.

    2. Create `src/lib/nis2/types.ts` with the following types. These are the shared domain types used across all NIS2 data files and the scoring engine:

       ```typescript
       // src/lib/nis2/types.ts

       /**
        * NIS2 Domain Types
        *
        * Legal basis: NIS2UmsG (BGBl. 2025 I Nr. 301)
        * These types model the structured data for NIS2 sectors, classification,
        * gap analysis questions, scoring, and recommendations.
        */

       // ============================================================
       // Sector & Classification Types
       // ============================================================

       export interface Subsector {
         id: string;
         nameKey: string; // Translation key: "sectors.{sectorId}.subsectors.{subsectorId}"
       }

       export interface Sector {
         id: string;
         nameKey: string; // Translation key: "sectors.{sectorId}.name"
         anlage: 1 | 2; // Anlage 1 (besonders wichtig + wichtig) or Anlage 2 (wichtig only)
         subsectors: Subsector[];
       }

       export type EntityCategory = 'besonders-wichtig' | 'wichtig' | 'nicht-betroffen';

       export interface ClassificationInput {
         sectorId: string;
         subsectorId: string | null;
         employees: number;
         annualRevenue: number; // EUR
         balanceSheet: number; // EUR
         isKritis: boolean; // Operator of critical infrastructure
       }

       export interface ClassificationResult {
         category: EntityCategory;
         reason: string; // Translation key for explanation
         legalReference: string; // e.g., "§28 Abs. 1 Nr. 1 BSIG"
       }

       export interface ClassificationThresholds {
         besondersWichtig: {
           /** Subsector IDs that are always "besonders wichtig" regardless of size */
           alwaysQualified: string[];
           /** Thresholds for telecom providers */
           telecom: { employees: number; revenue: number; balanceSheet: number };
           /** Thresholds for other Anlage 1 sectors */
           anlage1: { employees: number; revenue: number; balanceSheet: number };
         };
         wichtig: {
           /** Thresholds for Anlage 1 + 2 sectors */
           standard: { employees: number; revenue: number; balanceSheet: number };
         };
       }

       // ============================================================
       // Gap Analysis Types (used by Plan 02-02)
       // ============================================================

       export type MaturityLevel = 0 | 1 | 2 | 3;

       export type TrafficLight = 'red' | 'yellow' | 'green';

       export interface LegalReference {
         euArticle: string; // e.g., "Art. 21(2)(a)"
         bsigParagraph: string; // e.g., "§30 Abs. 2 Nr. 1 BSIG"
       }

       export interface Question {
         id: string;
         categoryId: string;
         titleKey: string; // Translation key for question text
         tooltipKey: string; // Translation key for tooltip explanation
         legalReference: LegalReference;
         maturityDescriptions: {
           level0Key: string; // Translation key for "Nicht umgesetzt" description
           level1Key: string; // Translation key for "Teilweise" description
           level2Key: string; // Translation key for "Größtenteils" description
           level3Key: string; // Translation key for "Vollständig" description
         };
       }

       export interface Category {
         id: string;
         nameKey: string; // Translation key: "categories.{categoryId}.name"
         shortNameKey: string; // Translation key: shorter name for UI tabs/navigation
         descriptionKey: string; // Translation key: official BSIG description
         euArticle: string; // e.g., "Art. 21(2)(a)"
         bsigParagraph: string; // e.g., "§30 Abs. 2 Nr. 1 BSIG"
         bsiBuildingBlocks: string[]; // e.g., ["ISMS.1", "ORP.1", "DER.1"]
         questions: Question[];
       }

       export interface Recommendation {
         id: string;
         categoryId: string;
         priority: 'high' | 'medium' | 'low';
         titleKey: string; // Translation key
         descriptionKey: string; // Translation key
         firstStepKey: string; // Translation key for concrete first action
         legalReference: string; // e.g., "Art. 21(2)(a), §30 Abs. 2 Nr. 1 BSIG"
         bsiReference: string; // e.g., "BSI-Standard 200-3, ISMS.1"
       }

       // ============================================================
       // Scoring Types (used by Plan 02-03)
       // ============================================================

       export interface Answer {
         questionId: string;
         categoryId: string;
         level: MaturityLevel;
       }

       export interface CategoryScore {
         categoryId: string;
         percentage: number; // 0-100, rounded to 1 decimal
         trafficLight: TrafficLight;
         answeredQuestions: number;
         totalQuestions: number;
       }

       export interface OverallScore {
         percentage: number; // 0-100, average of all category percentages
         trafficLight: TrafficLight;
         categoryScores: CategoryScore[];
         answeredQuestions: number;
         totalQuestions: number;
         completionRate: number; // 0-100
       }
       ```

    3. Create `src/lib/nis2/sectors.ts` with the COMPLETE 18-sector catalog. Every sector and subsector must be present. Use translation keys, not inline text.

       **CRITICAL: Include ALL sectors exactly as listed below. Do not skip any.**

       ```typescript
       // src/lib/nis2/sectors.ts

       import type { Sector } from './types';

       /**
        * Complete NIS2 Sector Catalog
        *
        * Legal basis: Anlagen 1 und 2 zum BSI-Gesetz (BSIG)
        * as amended by NIS2UmsG (BGBl. 2025 I Nr. 301)
        *
        * Anlage 1: Sectors for "besonders wichtige" AND "wichtige" Einrichtungen
        * Anlage 2: Sectors for "wichtige" Einrichtungen only
        */
       export const SECTORS: Sector[] = [
         // ============================================================
         // ANLAGE 1 - Sektoren besonders wichtiger und wichtiger Einrichtungen
         // ============================================================

         // 1. Energie
         {
           id: 'energy',
           nameKey: 'sectors.energy.name',
           anlage: 1,
           subsectors: [
             { id: 'electricity', nameKey: 'sectors.energy.subsectors.electricity' },
             { id: 'district-heating', nameKey: 'sectors.energy.subsectors.districtHeating' },
             { id: 'fuel', nameKey: 'sectors.energy.subsectors.fuel' },
             { id: 'gas', nameKey: 'sectors.energy.subsectors.gas' },
           ],
         },

         // 2. Transport und Verkehr (Anlage 1)
         {
           id: 'transport',
           nameKey: 'sectors.transport.name',
           anlage: 1,
           subsectors: [
             { id: 'air', nameKey: 'sectors.transport.subsectors.air' },
             { id: 'rail', nameKey: 'sectors.transport.subsectors.rail' },
             { id: 'maritime', nameKey: 'sectors.transport.subsectors.maritime' },
             { id: 'road', nameKey: 'sectors.transport.subsectors.road' },
           ],
         },

         // 3. Finanz- und Versicherungswesen
         {
           id: 'finance',
           nameKey: 'sectors.finance.name',
           anlage: 1,
           subsectors: [
             { id: 'banking', nameKey: 'sectors.finance.subsectors.banking' },
             { id: 'financial-infrastructure', nameKey: 'sectors.finance.subsectors.financialInfrastructure' },
           ],
         },

         // 4. Gesundheit
         {
           id: 'health',
           nameKey: 'sectors.health.name',
           anlage: 1,
           subsectors: [
             { id: 'health-services', nameKey: 'sectors.health.subsectors.healthServices' },
           ],
         },

         // 5. Wasser
         {
           id: 'water',
           nameKey: 'sectors.water.name',
           anlage: 1,
           subsectors: [
             { id: 'drinking-water', nameKey: 'sectors.water.subsectors.drinkingWater' },
             { id: 'wastewater', nameKey: 'sectors.water.subsectors.wastewater' },
           ],
         },

         // 6. Digitale Infrastruktur
         {
           id: 'digital-infrastructure',
           nameKey: 'sectors.digitalInfrastructure.name',
           anlage: 1,
           subsectors: [
             { id: 'ixp', nameKey: 'sectors.digitalInfrastructure.subsectors.ixp' },
             { id: 'dns', nameKey: 'sectors.digitalInfrastructure.subsectors.dns' },
             { id: 'tld', nameKey: 'sectors.digitalInfrastructure.subsectors.tld' },
             { id: 'cloud', nameKey: 'sectors.digitalInfrastructure.subsectors.cloud' },
             { id: 'datacenter', nameKey: 'sectors.digitalInfrastructure.subsectors.datacenter' },
             { id: 'cdn', nameKey: 'sectors.digitalInfrastructure.subsectors.cdn' },
             { id: 'tsp', nameKey: 'sectors.digitalInfrastructure.subsectors.tsp' },
           ],
         },

         // 7. Weltraum
         {
           id: 'space',
           nameKey: 'sectors.space.name',
           anlage: 1,
           subsectors: [
             { id: 'ground-infrastructure', nameKey: 'sectors.space.subsectors.groundInfrastructure' },
           ],
         },

         // ============================================================
         // ANLAGE 2 - Sektoren wichtiger Einrichtungen
         // ============================================================

         // 8. Post- und Kurierdienste
         {
           id: 'postal',
           nameKey: 'sectors.postal.name',
           anlage: 2,
           subsectors: [],
         },

         // 9. Abfallbewirtschaftung
         {
           id: 'waste-management',
           nameKey: 'sectors.wasteManagement.name',
           anlage: 2,
           subsectors: [],
         },

         // 10. Chemische Stoffe
         {
           id: 'chemicals',
           nameKey: 'sectors.chemicals.name',
           anlage: 2,
           subsectors: [],
         },

         // 11. Lebensmittel
         {
           id: 'food',
           nameKey: 'sectors.food.name',
           anlage: 2,
           subsectors: [],
         },

         // 12. Verarbeitendes Gewerbe / Herstellung von Waren
         {
           id: 'manufacturing',
           nameKey: 'sectors.manufacturing.name',
           anlage: 2,
           subsectors: [
             { id: 'medical-devices', nameKey: 'sectors.manufacturing.subsectors.medicalDevices' },
             { id: 'electronics', nameKey: 'sectors.manufacturing.subsectors.electronics' },
             { id: 'electrical-equipment', nameKey: 'sectors.manufacturing.subsectors.electricalEquipment' },
             { id: 'mechanical-engineering', nameKey: 'sectors.manufacturing.subsectors.mechanicalEngineering' },
             { id: 'motor-vehicles', nameKey: 'sectors.manufacturing.subsectors.motorVehicles' },
             { id: 'other-vehicles', nameKey: 'sectors.manufacturing.subsectors.otherVehicles' },
           ],
         },

         // 13. Anbieter digitaler Dienste
         {
           id: 'digital-services',
           nameKey: 'sectors.digitalServices.name',
           anlage: 2,
           subsectors: [
             { id: 'online-marketplace', nameKey: 'sectors.digitalServices.subsectors.onlineMarketplace' },
             { id: 'search-engine', nameKey: 'sectors.digitalServices.subsectors.searchEngine' },
             { id: 'social-network', nameKey: 'sectors.digitalServices.subsectors.socialNetwork' },
           ],
         },

         // 14. Forschung
         {
           id: 'research',
           nameKey: 'sectors.research.name',
           anlage: 2,
           subsectors: [
             { id: 'research-facilities', nameKey: 'sectors.research.subsectors.researchFacilities' },
           ],
         },
       ];

       /**
        * Get all sectors as a flat array.
        */
       export function getAllSectors(): Sector[] {
         return SECTORS;
       }

       /**
        * Find a sector by its ID.
        */
       export function getSectorById(id: string): Sector | undefined {
         return SECTORS.find((s) => s.id === id);
       }

       /**
        * Get sectors filtered by Anlage (1 or 2).
        */
       export function getSectorsByAnlage(anlage: 1 | 2): Sector[] {
         return SECTORS.filter((s) => s.anlage === anlage);
       }
       ```

  </action>
  <verify>
    - `npx tsc --noEmit` returns zero errors
    - `src/lib/nis2/types.ts` exists and exports Sector, Subsector, ClassificationInput, ClassificationResult types
    - `src/lib/nis2/sectors.ts` exists and exports SECTORS array with exactly 14 sector entries covering all 18 NIS2 sector categories
    - SECTORS array contains 7 Anlage 1 sectors and 7 Anlage 2 sectors
    - Every sector has an id, nameKey, anlage, and subsectors array
  </verify>
  <done>
    All NIS2 domain types defined in types.ts. Complete 14-entry sector catalog (covering 18 NIS2 categories) with subsectors, Anlage assignments, and translation keys. Zero TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create classification logic and add sector translations</name>
  <files>
    src/lib/nis2/classification.ts
    src/messages/de.json
    src/messages/en.json
  </files>
  <action>
    1. Create `src/lib/nis2/classification.ts` with the pure classification function implementing §28 BSIG thresholds:

       ```typescript
       // src/lib/nis2/classification.ts

       import type { ClassificationInput, ClassificationResult, ClassificationThresholds } from './types';
       import { SECTORS } from './sectors';

       /**
        * Classification Thresholds per §28 BSIG
        *
        * Legal basis: BGBl. 2025 I Nr. 301, §28 BSIG
        * Thresholds follow EU Recommendation 2003/361/EG
        */
       export const THRESHOLDS: ClassificationThresholds = {
         besondersWichtig: {
           // §28 Abs. 1 Nr. 1-2 BSIG: Always "besonders wichtig" regardless of size
           alwaysQualified: ['dns', 'tld', 'tsp'],
           // §28 Abs. 1 Nr. 3 BSIG: Telecommunications providers
           telecom: {
             employees: 50,
             revenue: 10_000_000, // >€10M
             balanceSheet: 10_000_000, // >€10M
           },
           // §28 Abs. 1 Nr. 4 BSIG: Other Anlage 1 sectors
           anlage1: {
             employees: 250, // ≥250
             revenue: 50_000_000, // >€50M
             balanceSheet: 43_000_000, // >€43M
           },
         },
         wichtig: {
           // §28 Abs. 2 BSIG: Anlagen 1 + 2
           standard: {
             employees: 50, // ≥50
             revenue: 10_000_000, // >€10M
             balanceSheet: 10_000_000, // >€10M
           },
         },
       };

       /**
        * Classifies an entity according to §28 BSIG.
        *
        * Classification hierarchy (checked in order):
        * 1. KRITIS operators → always "besonders wichtig" (§28 Abs. 1 Nr. 1)
        * 2. qTSP, DNS, TLD → always "besonders wichtig" (§28 Abs. 1 Nr. 2)
        * 3. Anlage 1 sectors with large thresholds → "besonders wichtig" (§28 Abs. 1 Nr. 4)
        * 4. Anlage 1 + 2 sectors with standard thresholds → "wichtig" (§28 Abs. 2)
        * 5. Below all thresholds → "nicht betroffen"
        *
        * Legal basis: BGBl. 2025 I Nr. 301, §28 BSIG
        *
        * @param input - Entity data for classification
        * @returns Classification result with category, reason key, and legal reference
        */
       export function classifyEntity(input: ClassificationInput): ClassificationResult {
         const { sectorId, subsectorId, employees, annualRevenue, balanceSheet, isKritis } = input;

         // Step 1: KRITIS operators are always "besonders wichtig" (§28 Abs. 1 Nr. 1 BSIG)
         if (isKritis) {
           return {
             category: 'besonders-wichtig',
             reason: 'classification.reasons.kritis',
             legalReference: '§28 Abs. 1 Nr. 1 BSIG',
           };
         }

         // Step 2: Special subsectors always "besonders wichtig" regardless of size (§28 Abs. 1 Nr. 2 BSIG)
         // This covers: qualified trust service providers (qTSP), DNS providers, TLD registries
         if (subsectorId && THRESHOLDS.besondersWichtig.alwaysQualified.includes(subsectorId)) {
           return {
             category: 'besonders-wichtig',
             reason: 'classification.reasons.alwaysQualified',
             legalReference: '§28 Abs. 1 Nr. 2 BSIG',
           };
         }

         // Look up sector to determine Anlage
         const sector = SECTORS.find((s) => s.id === sectorId);

         // If sector not found in NIS2 Anlagen, entity is not affected
         if (!sector) {
           return {
             category: 'nicht-betroffen',
             reason: 'classification.reasons.sectorNotRegulated',
             legalReference: '§28 BSIG',
           };
         }

         // Step 3: Anlage 1 sectors — check "besonders wichtig" thresholds (§28 Abs. 1 Nr. 4 BSIG)
         if (sector.anlage === 1) {
           const t = THRESHOLDS.besondersWichtig.anlage1;
           const meetsEmployeeThreshold = employees >= t.employees;
           const meetsFinancialThreshold = annualRevenue > t.revenue && balanceSheet > t.balanceSheet;

           if (meetsEmployeeThreshold || meetsFinancialThreshold) {
             return {
               category: 'besonders-wichtig',
               reason: 'classification.reasons.anlage1LargeEntity',
               legalReference: '§28 Abs. 1 Nr. 4 BSIG',
             };
           }
         }

         // Step 4: Anlage 1 + 2 sectors — check "wichtig" thresholds (§28 Abs. 2 BSIG)
         const t = THRESHOLDS.wichtig.standard;
         const meetsEmployeeThreshold = employees >= t.employees;
         const meetsFinancialThreshold = annualRevenue > t.revenue && balanceSheet > t.balanceSheet;

         if (meetsEmployeeThreshold || meetsFinancialThreshold) {
           return {
             category: 'wichtig',
             reason: 'classification.reasons.standardThreshold',
             legalReference: '§28 Abs. 2 BSIG',
           };
         }

         // Step 5: Below all thresholds — not affected by NIS2
         return {
           category: 'nicht-betroffen',
           reason: 'classification.reasons.belowThreshold',
           legalReference: '§28 BSIG',
         };
       }
       ```

    2. Update `src/messages/de.json` — ADD the following keys to the existing JSON (merge into existing structure, do NOT overwrite existing keys like "metadata", "common", "landing", "footer"):

       Add these top-level keys:

       ```json
       "sectors": {
         "energy": {
           "name": "Energie",
           "subsectors": {
             "electricity": "Stromversorgung",
             "districtHeating": "Fernwärme- und Fernkälteversorgung",
             "fuel": "Kraftstoff- und Heizölversorgung",
             "gas": "Gasversorgung"
           }
         },
         "transport": {
           "name": "Transport und Verkehr",
           "subsectors": {
             "air": "Luftverkehr",
             "rail": "Schienenverkehr",
             "maritime": "Schifffahrt",
             "road": "Straßenverkehr"
           }
         },
         "finance": {
           "name": "Finanz- und Versicherungswesen",
           "subsectors": {
             "banking": "Bankwesen",
             "financialInfrastructure": "Finanzmarktinfrastrukturen"
           }
         },
         "health": {
           "name": "Gesundheit",
           "subsectors": {
             "healthServices": "Gesundheitsdienstleistungen"
           }
         },
         "water": {
           "name": "Wasser",
           "subsectors": {
             "drinkingWater": "Trinkwasserversorgung",
             "wastewater": "Abwasserbeseitigung"
           }
         },
         "digitalInfrastructure": {
           "name": "Digitale Infrastruktur",
           "subsectors": {
             "ixp": "Internet Exchange Points (IXPs)",
             "dns": "DNS-Diensteanbieter",
             "tld": "Top-Level-Domain-Namenregister (TLD)",
             "cloud": "Cloud-Computing-Dienste",
             "datacenter": "Rechenzentrumsdienste",
             "cdn": "Content-Delivery-Netzwerke (CDN)",
             "tsp": "Vertrauensdiensteanbieter"
           }
         },
         "space": {
           "name": "Weltraum",
           "subsectors": {
             "groundInfrastructure": "Bodeninfrastrukturen für Weltraumaktivitäten"
           }
         },
         "postal": {
           "name": "Post- und Kurierdienste"
         },
         "wasteManagement": {
           "name": "Abfallbewirtschaftung"
         },
         "chemicals": {
           "name": "Produktion, Herstellung und Handel mit chemischen Stoffen"
         },
         "food": {
           "name": "Produktion, Verarbeitung und Vertrieb von Lebensmitteln"
         },
         "manufacturing": {
           "name": "Verarbeitendes Gewerbe / Herstellung von Waren",
           "subsectors": {
             "medicalDevices": "Herstellung von Medizinprodukten und In-vitro-Diagnostika",
             "electronics": "Herstellung von Datenverarbeitungsgeräten, elektronischen und optischen Erzeugnissen",
             "electricalEquipment": "Herstellung von elektrischen Ausrüstungen",
             "mechanicalEngineering": "Maschinenbau",
             "motorVehicles": "Herstellung von Kraftwagen und Kraftwagenteilen",
             "otherVehicles": "Sonstiger Fahrzeugbau"
           }
         },
         "digitalServices": {
           "name": "Anbieter digitaler Dienste",
           "subsectors": {
             "onlineMarketplace": "Online-Marktplätze",
             "searchEngine": "Online-Suchmaschinen",
             "socialNetwork": "Plattformen für Dienste sozialer Netzwerke"
           }
         },
         "research": {
           "name": "Forschung",
           "subsectors": {
             "researchFacilities": "Forschungseinrichtungen"
           }
         }
       },
       "classification": {
         "categories": {
           "besondersWichtig": "Besonders wichtige Einrichtung",
           "wichtig": "Wichtige Einrichtung",
           "nichtBetroffen": "Nicht von NIS2 betroffen"
         },
         "reasons": {
           "kritis": "Als Betreiber kritischer Infrastruktur (KRITIS) sind Sie unabhängig von der Unternehmensgröße als besonders wichtige Einrichtung eingestuft.",
           "alwaysQualified": "Ihr Tätigkeitsbereich (qualifizierter Vertrauensdiensteanbieter, DNS-Diensteanbieter oder TLD-Namenregister) fällt unabhängig von der Unternehmensgröße unter die besonders wichtigen Einrichtungen.",
           "anlage1LargeEntity": "Ihr Unternehmen erfüllt die Größenschwellen für besonders wichtige Einrichtungen: mindestens 250 Beschäftigte ODER Jahresumsatz über 50 Mio. EUR und Bilanzsumme über 43 Mio. EUR.",
           "standardThreshold": "Ihr Unternehmen erfüllt die Schwellenwerte für wichtige Einrichtungen: mindestens 50 Beschäftigte ODER Jahresumsatz über 10 Mio. EUR und Bilanzsumme über 10 Mio. EUR.",
           "belowThreshold": "Ihr Unternehmen liegt unterhalb der NIS2-Schwellenwerte (weniger als 50 Beschäftigte UND Jahresumsatz/Bilanzsumme unter 10 Mio. EUR). Sie sind voraussichtlich nicht direkt von NIS2 betroffen.",
           "sectorNotRegulated": "Ihr Sektor fällt nicht unter die NIS2-regulierten Sektoren der Anlagen 1 und 2 zum BSIG."
         },
         "supplychainHint": "Hinweis: Auch wenn Sie nicht direkt von NIS2 betroffen sind, können Ihre Kunden oder Auftraggeber als NIS2-regulierte Einrichtungen Sicherheitsanforderungen an Sie als Lieferant stellen (Art. 21(2)(d), §30 Abs. 2 Nr. 4 BSIG).",
         "anlageLabels": {
           "anlage1": "Anlage 1 zum BSIG (Sektoren besonders wichtiger und wichtiger Einrichtungen)",
           "anlage2": "Anlage 2 zum BSIG (Sektoren wichtiger Einrichtungen)"
         }
       }
       ```

    3. Update `src/messages/en.json` — ADD the following keys (merge, do NOT overwrite existing):

       ```json
       "sectors": {
         "energy": {
           "name": "Energy",
           "subsectors": {
             "electricity": "Electricity supply",
             "districtHeating": "District heating and cooling",
             "fuel": "Fuel and heating oil supply",
             "gas": "Gas supply"
           }
         },
         "transport": {
           "name": "Transport and Traffic",
           "subsectors": {
             "air": "Air traffic",
             "rail": "Rail transport",
             "maritime": "Maritime transport",
             "road": "Road traffic"
           }
         },
         "finance": {
           "name": "Finance and Insurance",
           "subsectors": {
             "banking": "Banking",
             "financialInfrastructure": "Financial market infrastructure"
           }
         },
         "health": {
           "name": "Health",
           "subsectors": {
             "healthServices": "Health services"
           }
         },
         "water": {
           "name": "Water",
           "subsectors": {
             "drinkingWater": "Drinking water supply",
             "wastewater": "Wastewater disposal"
           }
         },
         "digitalInfrastructure": {
           "name": "Digital Infrastructure",
           "subsectors": {
             "ixp": "Internet Exchange Points (IXPs)",
             "dns": "DNS service providers",
             "tld": "Top-Level Domain (TLD) registries",
             "cloud": "Cloud computing services",
             "datacenter": "Data center services",
             "cdn": "Content Delivery Networks (CDN)",
             "tsp": "Trust service providers"
           }
         },
         "space": {
           "name": "Space",
           "subsectors": {
             "groundInfrastructure": "Ground infrastructure for space activities"
           }
         },
         "postal": {
           "name": "Postal and Courier Services"
         },
         "wasteManagement": {
           "name": "Waste Management"
         },
         "chemicals": {
           "name": "Production, Manufacturing, and Trade of Chemical Substances"
         },
         "food": {
           "name": "Production, Processing, and Distribution of Food"
         },
         "manufacturing": {
           "name": "Manufacturing / Production of Goods",
           "subsectors": {
             "medicalDevices": "Medical devices and in vitro diagnostics",
             "electronics": "Data processing equipment, electronic and optical products",
             "electricalEquipment": "Electrical equipment",
             "mechanicalEngineering": "Mechanical engineering",
             "motorVehicles": "Motor vehicles and parts",
             "otherVehicles": "Other vehicle manufacturing"
           }
         },
         "digitalServices": {
           "name": "Digital Service Providers",
           "subsectors": {
             "onlineMarketplace": "Online marketplaces",
             "searchEngine": "Online search engines",
             "socialNetwork": "Social networking platforms"
           }
         },
         "research": {
           "name": "Research",
           "subsectors": {
             "researchFacilities": "Research facilities"
           }
         }
       },
       "classification": {
         "categories": {
           "besondersWichtig": "Particularly important entity",
           "wichtig": "Important entity",
           "nichtBetroffen": "Not affected by NIS2"
         },
         "reasons": {
           "kritis": "As an operator of critical infrastructure (KRITIS), you are classified as a particularly important entity regardless of company size.",
           "alwaysQualified": "Your area of activity (qualified trust service provider, DNS service provider, or TLD registry) falls under particularly important entities regardless of company size.",
           "anlage1LargeEntity": "Your company meets the size thresholds for particularly important entities: at least 250 employees OR annual revenue above EUR 50M and balance sheet above EUR 43M.",
           "standardThreshold": "Your company meets the thresholds for important entities: at least 50 employees OR annual revenue above EUR 10M and balance sheet above EUR 10M.",
           "belowThreshold": "Your company is below the NIS2 thresholds (fewer than 50 employees AND annual revenue/balance sheet below EUR 10M). You are likely not directly affected by NIS2.",
           "sectorNotRegulated": "Your sector does not fall under the NIS2-regulated sectors of Annexes 1 and 2 of the BSIG."
         },
         "supplychainHint": "Note: Even if you are not directly affected by NIS2, your customers or clients as NIS2-regulated entities may impose security requirements on you as a supplier (Art. 21(2)(d), §30 Abs. 2 Nr. 4 BSIG).",
         "anlageLabels": {
           "anlage1": "Annex 1 to BSIG (Sectors of particularly important and important entities)",
           "anlage2": "Annex 2 to BSIG (Sectors of important entities)"
         }
       }
       ```

       IMPORTANT: When merging into the JSON files, preserve ALL existing keys (metadata, common, landing, footer, etc.) and add the new "sectors" and "classification" top-level keys. Do not change the structure of any existing keys.

  </action>
  <verify>
    - `npx tsc --noEmit` returns zero errors
    - `src/lib/nis2/classification.ts` exports classifyEntity function and THRESHOLDS constant
    - Classification function returns correct results for these test cases:
      - KRITIS entity → 'besonders-wichtig'
      - DNS provider → 'besonders-wichtig'
      - Energy sector, 300 employees → 'besonders-wichtig'
      - Energy sector, 60 employees → 'wichtig'
      - Manufacturing, 60 employees → 'wichtig'
      - Manufacturing, 30 employees, low revenue → 'nicht-betroffen'
    - de.json contains "sectors" and "classification" keys with German translations
    - en.json contains "sectors" and "classification" keys with English translations
    - All existing keys in de.json and en.json are preserved
  </verify>
  <done>
    Classification function correctly implements §28 BSIG thresholds. German and English translations for all 14 sectors and their subsectors. KRITIS, DNS, TLD, and qTSP are correctly classified as always "besonders wichtig". Size thresholds match the exact legal requirements. Zero TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` returns zero TypeScript errors
2. `src/lib/nis2/types.ts` contains all domain types (Sector, Classification, Question, Category, Answer, Score types)
3. `src/lib/nis2/sectors.ts` contains exactly 14 sector entries (7 Anlage 1, 7 Anlage 2) with all subsectors
4. `src/lib/nis2/classification.ts` implements §28 BSIG classification with correct thresholds
5. `src/messages/de.json` contains German translations for all sectors, subsectors, and classification results
6. `src/messages/en.json` contains English translations for all sectors, subsectors, and classification results
7. All existing i18n keys (metadata, common, landing, footer) are preserved unchanged
8. Special cases (KRITIS, DNS, TLD, qTSP) always return "besonders-wichtig"
</verification>

<success_criteria>
- All 18 NIS2 sector categories exist as structured TypeScript data with correct Anlage assignments
- Classification function implements exact §28 BSIG thresholds (250/50M/43M for besonders wichtig, 50/10M/10M for wichtig)
- Special cases (DNS, TLD, qTSP, KRITIS) are always "besonders wichtig"
- German and English translations exist for every sector, subsector, and classification result
- TypeScript compiles with zero errors
- No React or UI code — pure data and logic only
</success_criteria>

<output>
After completion, create `.planning/phases/02-nis2-content-scoring-engine/02-01-SUMMARY.md`
</output>
