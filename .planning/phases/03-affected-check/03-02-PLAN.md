---
phase: 03-affected-check
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/app/[locale]/check/page.tsx
  - src/app/[locale]/check/steps/sector-selection.tsx
  - src/app/[locale]/check/steps/company-size.tsx
  - src/app/[locale]/check/steps/result.tsx
  - src/app/[locale]/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can select their sector from all 18 NIS2 sectors grouped by Anlage 1 and Anlage 2"
    - "User can select a subsector when the chosen sector has subsectors (progressive disclosure)"
    - "Selecting 'Mein Sektor ist nicht aufgef√ºhrt' skips directly to 'nicht betroffen' result -- no company size step shown"
    - "User can enter employee count and annual revenue with thousand-separator formatting (1000 displays as 1.000)"
    - "User can optionally enter balance sheet total with info tooltip; when omitted, classification uses only employee count and revenue"
    - "User can check KRITIS checkbox with tooltip explanation"
    - "System classifies as besonders-wichtig, wichtig, or nicht-betroffen using classifyEntity()"
    - "Result shows color-coded card with icon, classification label, legal reference, and expandable explanation"
    - "Nicht-betroffen result shows supply chain hint info box"
    - "Primary CTA 'Reifegrad pruefen' and Secondary CTA 'Erneut pruefen' are shown on result"
    - "Step indicator shows progress through 3 steps"
    - "User can navigate back without losing entered data (form data persists in localStorage via zustand persist)"
    - "Submitting with empty required fields shows inline validation errors below each field"
    - "A company with high revenue but omitted balance sheet is correctly classified (not penalized for missing balance sheet)"
  artifacts:
    - path: "src/app/[locale]/check/page.tsx"
      provides: "Main wizard container page at /[locale]/check route"
      exports: ["default"]
    - path: "src/app/[locale]/check/steps/sector-selection.tsx"
      provides: "Step 1: Sector and subsector selection with grouped dropdown"
      exports: ["SectorSelectionStep"]
    - path: "src/app/[locale]/check/steps/company-size.tsx"
      provides: "Step 2: Employee count, revenue, balance sheet, KRITIS inputs"
      exports: ["CompanySizeStep"]
    - path: "src/app/[locale]/check/steps/result.tsx"
      provides: "Step 3: Classification result with color card, explanation, CTAs"
      exports: ["ResultStep"]
  key_links:
    - from: "src/app/[locale]/check/page.tsx"
      to: "src/stores/wizard-store.ts"
      via: "useWizardStore hook for step routing"
      pattern: "useWizardStore"
    - from: "src/app/[locale]/check/steps/sector-selection.tsx"
      to: "src/lib/nis2/sectors.ts"
      via: "SECTORS import for dropdown population"
      pattern: "SECTORS|getSectorsByAnlage"
    - from: "src/app/[locale]/check/steps/result.tsx"
      to: "src/lib/nis2/classification.ts"
      via: "classifyEntity() call with form data, balanceSheet mapped to Number.MAX_SAFE_INTEGER when omitted"
      pattern: "classifyEntity"
    - from: "src/app/[locale]/check/steps/result.tsx"
      to: "src/messages/de.json"
      via: "useTranslations for classification reasons and labels"
      pattern: "useTranslations"
    - from: "src/app/[locale]/page.tsx"
      to: "src/app/[locale]/check/page.tsx"
      via: "Landing page CTA links to /check"
      pattern: "href.*check"
---

<objective>
Build the complete 3-step Affected Check wizard UI: sector selection (Step 1), company size inputs (Step 2), and classification result display (Step 3), plus the wizard container page and landing page CTA link.

Purpose: Deliver the first interactive user feature -- users can determine NIS2 affected status through a guided wizard that classifies their company using the existing Par. 28 BSIG classification logic from Phase 2.
Output: Working wizard at /[locale]/check with all 3 steps, form validation, classification, and result display.
</objective>

<execution_context>
@C:\Users\mjoan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\mjoan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-affected-check/03-RESEARCH.md
@.planning/phases/03-affected-check/03-CONTEXT.md
@.planning/phases/03-affected-check/03-01-SUMMARY.md
@src/stores/wizard-store.ts
@src/lib/nis2/types.ts
@src/lib/nis2/sectors.ts
@src/lib/nis2/classification.ts
@src/messages/de.json
@src/messages/en.json
@src/app/[locale]/page.tsx
@src/app/[locale]/layout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create wizard container page, sector selection step, and company size step</name>
  <files>
    src/app/[locale]/check/page.tsx
    src/app/[locale]/check/steps/sector-selection.tsx
    src/app/[locale]/check/steps/company-size.tsx
  </files>
  <action>
**IMPORTANT HYDRATION PATTERN:** The wizard uses zustand persist (localStorage). To avoid Next.js hydration mismatch, the check/page.tsx MUST use `'use client'` and the isClient pattern:
```typescript
const [isClient, setIsClient] = useState(false);
useEffect(() => setIsClient(true), []);
if (!isClient) return <WizardSkeleton />;
```
The skeleton should render the same outer structure (max-w-3xl container, StepIndicator placeholder) to minimize layout shift.

**A) src/app/[locale]/check/page.tsx** -- Main wizard container.

`'use client'` component that:
1. Reads `currentStep` from `useWizardStore()`
2. Uses the isClient hydration guard pattern (see above)
3. Renders `StepIndicator` at top with step labels from `useTranslations('check.steps')`
4. Conditionally renders the correct step component based on `currentStep`:
   - 0: `<SectorSelectionStep />`
   - 1: `<CompanySizeStep />`
   - 2: `<ResultStep />`
5. Layout: `max-w-3xl mx-auto px-4 py-8 sm:py-12` centered container
6. Page title: `<h1>` with `check.title` translation
7. Subtitle: `<p>` with `check.subtitle` translation (shown only on steps 0 and 1, not on result)

**B) src/app/[locale]/check/steps/sector-selection.tsx** -- Step 1.

`'use client'` component using React Hook Form + Zod:

Zod schema:
```typescript
const sectorSchema = z.object({
  sectorId: z.string().min(1, t('check.sectorStep.sectorRequired')),
  subsectorId: z.string().nullable(),
});
```

NOTE: Since the Zod schema needs translation strings and `t()` is a hook, define the schema INSIDE the component function (not at module level). This is fine for a small schema.

Form setup:
- `useForm` with `zodResolver(sectorSchema)`, `mode: 'onSubmit'`
- `defaultValues` from `formData` in wizard store
- On submit: `updateFormData(data)` then `nextStep()`

UI elements:
1. Grouped Select dropdown for sectors (shadcn Select):
   - `<SelectGroup>` with `<SelectLabel>` "Sektoren hoher Kritikalitaet (Anlage 1)" containing all Anlage 1 sectors
   - `<SelectGroup>` with `<SelectLabel>` "Sonstige kritische Sektoren (Anlage 2)" containing all Anlage 2 sectors
   - `<Separator />` after groups
   - `<SelectItem value="not-listed">` "Mein Sektor ist nicht aufgefuehrt"
   - Use `<SelectContent position="popper" className="max-h-[60vh]">` for mobile compatibility
   - **Sector name translation pattern:** The sector `nameKey` is formatted as `'sectors.energy.name'`. When using `useTranslations('sectors')`, strip the `'sectors.'` prefix to get the scoped key. Example: `const tSectors = useTranslations('sectors')` then `tSectors('energy.name')` for a sector with `nameKey: 'sectors.energy.name'`. Concretely: `tSectors(sector.nameKey.split('.').slice(1).join('.'))` which transforms `'sectors.energy.name'` into `'energy.name'`. Same pattern applies to subsector nameKeys: `'sectors.energy.subsectors.electricity'` becomes `'energy.subsectors.electricity'`.

2. Conditional subsector dropdown (progressive disclosure):
   - Only shows when selected sector has subsectors (check `selectedSector.subsectors.length > 0`)
   - Use `watch('sectorId')` from React Hook Form to track selection
   - When sector changes, reset subsectorId to null via `setValue('subsectorId', null)`
   - Subsector names via translations using same pattern

3. "Not listed" shortcut:
   - When `sectorId === 'not-listed'`, call `updateFormData({ sectorId: 'not-listed' })` and set `currentStep` directly to 2 (result step), skipping company size
   - The result step must handle this case and show "nicht betroffen" with supply chain hint

4. shadcn Select integration with React Hook Form:
   - shadcn Select uses `onValueChange` not native `onChange`. Use `Controller` from react-hook-form:
   ```typescript
   <Controller
     name="sectorId"
     control={control}
     render={({ field }) => (
       <Select value={field.value} onValueChange={field.onChange}>
         ...
       </Select>
     )}
   />
   ```

5. Navigation: Render `<WizardNavigation>` with `isFirstStep={true}` and `isLastStep={false}`

6. Error display: Show validation error below Select when present, using `text-sm text-red-600`

**C) src/app/[locale]/check/steps/company-size.tsx** -- Step 2.

`'use client'` component using React Hook Form + Zod + react-number-format:

Zod schema (defined inside component for t() access):
```typescript
const companySizeSchema = z.object({
  employees: z.number({ required_error: t('check.sizeStep.employeesRequired') }).min(1, t('check.sizeStep.employeesRequired')),
  annualRevenue: z.number({ required_error: t('check.sizeStep.revenueRequired') }).min(0, t('check.sizeStep.revenueRequired')),
  balanceSheet: z.number().optional().default(0),
  isKritis: z.boolean().default(false),
});
```

Form setup:
- `useForm` with `zodResolver(companySizeSchema)`, `mode: 'onSubmit'`
- `defaultValues` from `formData` in wizard store (use 0 defaults for numbers if not set)
- On submit: `updateFormData(data)` then `nextStep()`

UI elements:
1. Employee count input: `NumericFormat` with `Controller`:
   - `customInput={Input}`, `type="text"`, `inputMode="numeric"`
   - `thousandSeparator="."`, `decimalSeparator=","`
   - `allowNegative={false}`, `decimalScale={0}`
   - `onValueChange={(values) => field.onChange(values.floatValue ?? 0)}`
   - Label: `check.sizeStep.employeesLabel`

2. Annual revenue input: Same `NumericFormat` pattern:
   - Add `suffix=" EUR"` or no suffix (label says EUR already)
   - `thousandSeparator="."`, `decimalSeparator=","`
   - `decimalScale={0}`, `allowNegative={false}`
   - Label: `check.sizeStep.revenueLabel`

3. Balance sheet input (optional):
   - Same `NumericFormat` pattern
   - Label with "(optional)" suffix: `check.sizeStep.balanceSheetLabel` + `check.sizeStep.balanceSheetOptional`
   - Info icon with `Tooltip` (shadcn): `check.sizeStep.balanceSheetTooltip`
   - Use `Info` icon from lucide-react next to label, wrapped in `TooltipTrigger`
   - Tooltip requires `TooltipProvider` wrapping (can wrap just this field group)

4. KRITIS checkbox:
   - `Checkbox` (shadcn) with label `check.sizeStep.kritisLabel`
   - Styled subtly: smaller text, muted color, positioned below the number inputs
   - Info icon with `Tooltip`: `check.sizeStep.kritisTooltip`
   - Use `Controller` to connect shadcn Checkbox with React Hook Form:
   ```typescript
   <Controller
     name="isKritis"
     control={control}
     render={({ field }) => (
       <Checkbox checked={field.value} onCheckedChange={field.onChange} />
     )}
   />
   ```

5. Navigation: `<WizardNavigation>` with `isFirstStep={false}`, `isLastStep={true}`
   - Back calls `prevStep()` from store
   - Submit triggers form handleSubmit

6. Error display: Below each field when validation fails

7. Accessibility: All inputs have `id` matching `htmlFor` on Label, `aria-invalid` when errored, `aria-describedby` pointing to error message `<p>` ids.
  </action>
  <verify>
1. Run `npx tsc --noEmit` -- no TypeScript errors
2. Run `npm run build` -- build succeeds with check route
3. Run `npm run dev` and navigate to `http://localhost:3000/de/check`:
   - Step indicator shows "1. Sektor" as active
   - Sector dropdown shows 14 sectors grouped by Anlage
   - Selecting "Energie" shows subsector dropdown with 4 options
   - Selecting "Post- und Kurierdienste" shows no subsector dropdown
   - Clicking "Weiter" without selection shows validation error below dropdown
   - After selecting sector, clicking "Weiter" advances to step 2
4. On step 2:
   - Employee and revenue inputs format with thousand separators (type "1000" -> "1.000")
   - Balance sheet shows "(optional)" and info tooltip on hover/click
   - KRITIS checkbox with tooltip is visible
   - "Zurueck" returns to step 1 with sector selection preserved
   - Clicking "Ergebnis anzeigen" without filling required fields shows inline errors
   - "Ergebnis anzeigen" validates and shows result when valid
5. Verify "Mein Sektor ist nicht aufgefuehrt" shortcut: select it -> verify wizard jumps directly to step 3 (result), no company size step shown
  </verify>
  <done>
- Wizard container at /[locale]/check renders steps conditionally based on currentStep
- Sector selection with grouped dropdown (Anlage 1/2) and progressive subsector disclosure
- "Mein Sektor ist nicht aufgefuehrt" shortcut jumps directly to result step
- Company size inputs with thousand-separator formatting and optional balance sheet
- KRITIS checkbox with tooltip
- Form validation shows inline errors for required fields
- Back navigation preserves entered data via zustand persist
  </done>
</task>

<task type="auto">
  <name>Task 2: Create result step, update landing page CTA, and fix balance sheet classification</name>
  <files>
    src/app/[locale]/check/steps/result.tsx
    src/app/[locale]/page.tsx
  </files>
  <action>
**A) src/app/[locale]/check/steps/result.tsx** -- Step 3.

`'use client'` component that:

1. Reads `formData` from wizard store
2. Calls `classifyEntity()` with the stored form data, applying the **CRITICAL balance sheet mapping:**
   - Must handle the "not-listed" sectorId case: if `sectorId === 'not-listed'`, directly show `nicht-betroffen` result without calling classifyEntity
   - **BALANCE SHEET OPTIONAL HANDLING (CRITICAL):** When constructing `ClassificationInput` from formData, if `balanceSheet` is 0, undefined, or not provided, pass `Number.MAX_SAFE_INTEGER` instead of 0. This ensures the balance sheet threshold check does NOT block classification when the user chose not to provide it.

     **Why this matters:** The classification.ts logic uses `annualRevenue > threshold.revenue && balanceSheet > threshold.balanceSheet`. If balance sheet is passed as 0 (default for omitted), then `0 > 43_000_000` is always false, which means the revenue+balanceSheet path ALWAYS fails. This would incorrectly classify a company with 10 employees and 100M EUR revenue as "nicht betroffen" just because they didn't provide a balance sheet. Passing `Number.MAX_SAFE_INTEGER` makes the balance sheet check a no-op, so `annualRevenue > threshold.revenue && MAX_SAFE_INTEGER > threshold.balanceSheet` simplifies to just `annualRevenue > threshold.revenue`.

     Concrete code:
     ```typescript
     const classificationInput: ClassificationInput = {
       sectorId: formData.sectorId!,
       subsectorId: formData.subsectorId ?? null,
       employees: formData.employees ?? 0,
       annualRevenue: formData.annualRevenue ?? 0,
       // When balance sheet is not provided (0 or undefined), use MAX_SAFE_INTEGER
       // so the threshold check doesn't block. User decision: balance sheet is optional,
       // classification uses only employee count and revenue when omitted.
       balanceSheet: formData.balanceSheet && formData.balanceSheet > 0
         ? formData.balanceSheet
         : Number.MAX_SAFE_INTEGER,
       isKritis: formData.isKritis ?? false,
     };
     ```

3. **TELECOM NOTE:** The `THRESHOLDS.besondersWichtig.telecom` threshold in classification.ts is defined but never checked in `classifyEntity()`. There is also no separate telecom sector in sectors.ts -- telecommunications providers are covered under the `digital-infrastructure` sector. The telecom threshold is dead code from an earlier iteration. This plan does NOT add telecom-specific logic because: (a) no telecom sector/subsector exists in the data model, and (b) adding it would require Phase 2 data changes. This is a known limitation to be addressed if needed in a future phase. The existing classification correctly handles all 14 sectors and their subsectors including the `alwaysQualified` subsectors (dns, tld, tsp) under digital-infrastructure.

4. Displays result in a color-coded Card:

   Result card configs:
   - `besonders-wichtig`: `bg-red-50 border-red-500 border-2`, `AlertCircle` icon in `text-red-600`, title text `text-red-900`
   - `wichtig`: `bg-orange-50 border-orange-500 border-2`, `AlertTriangle` icon in `text-orange-600`, title text `text-orange-900`
   - `nicht-betroffen`: `bg-green-50 border-green-500 border-2`, `CheckCircle` icon in `text-green-600`, title text `text-green-900`

   Card structure:
   - Icon (h-10 w-10) + classification label (CardTitle, text-2xl) in flex row
   - Legal reference as CardDescription (e.g., "Par. 28 Abs. 1 Nr. 1 BSIG")

5. Expandable "Warum?" section:
   - Button/trigger styled as text link: "Warum diese Einstufung?" (check.resultStep.whyTitle)
   - Use a simple `useState` toggle (no external accordion library needed)
   - When expanded: shows the `reason` text from ClassificationResult (which is a translation key -- resolve via `useTranslations('classification')`)
   - Show legal reference with label: "Rechtsgrundlage: Par. 28 Abs. X BSIG"

6. Supply chain hint (only for `nicht-betroffen`):
   - Yellow-bordered info box below result card: `bg-yellow-50 border-yellow-400 border p-4 rounded-lg`
   - `Info` icon from lucide-react in `text-yellow-600`
   - Title: `check.resultStep.supplyChainTitle`
   - Text: `check.resultStep.supplyChainText` (or use existing `classification.supplychainHint` from de.json)

7. CTAs:
   - Primary: `Button size="lg"` "Reifegrad pruefen" (check.resultStep.ctaPrimary)
     - For now, link to `#` or `/gap-analysis` (Phase 4 route, not yet built). Use `Link` from `next/link` with locale-aware path. If the route doesn't exist yet, still link to `/[locale]/gap-analysis` -- it will 404 but will be wired in Phase 4.
   - Secondary: `Button variant="outline" size="lg"` "Erneut pruefen" (check.resultStep.ctaSecondary)
     - Calls `reset()` from wizard store (resets formData and currentStep to 0)

8. No navigation component on result step (CTAs replace it)

**B) Update landing page CTA** -- Modify `src/app/[locale]/page.tsx`:
- Change the hero CTA `<Button>` to wrap in or replace with a `Link` from `next/link` pointing to `/check` (or `/{locale}/check`)
- Use `useTranslations` already present. The link should be locale-aware.
- Since the page is a server component, use `<Link href="/check">` which next-intl middleware will handle.
- Wrap the `<Button>` with `asChild` prop and nest `<Link>` inside:
  ```tsx
  <Button size="lg" className="text-lg px-8 py-6" asChild>
    <Link href="/check">{t('cta')}</Link>
  </Button>
  ```
- Import `Link` from `next/link` at the top of the file.
  </action>
  <verify>
1. Run `npx tsc --noEmit` -- no TypeScript errors
2. Run `npm run build` -- build succeeds
3. On result step:
   - Color-coded card displays correct classification
   - "Warum?" expands to show legal reasoning
   - "Reifegrad pruefen" and "Erneut pruefen" buttons visible
   - "Erneut pruefen" resets to step 1
4. Test "Mein Sektor ist nicht aufgefuehrt" shortcut path:
   - Select "Mein Sektor ist nicht aufgefuehrt" -> verify wizard jumps directly to GREEN "nicht betroffen" result with supply chain hint box, no company size step shown
5. Test balance sheet optional handling (CRITICAL):
   - Select "Post- und Kurierdienste" (Anlage 2), enter 10 employees, 15.000.000 EUR revenue, leave balance sheet EMPTY
   - Verify result is "wichtig" (NOT "nicht betroffen") -- because 15M > 10M threshold and omitted balance sheet should not block
   - Now enter same data WITH balance sheet = 5.000.000 EUR
   - Verify result is STILL "wichtig" -- 15M > 10M revenue AND 5M < 10M balance sheet but the condition is `revenue > 10M && balanceSheet > 10M`, so this should actually be "nicht betroffen" now (balance sheet too low blocks it)
   - This confirms the optional logic works: omitted = no blocking, provided = checked normally
6. Test special cases:
   - Selecting digital-infrastructure/dns -> "besonders wichtig" regardless of company size
   - 300 employees + Energie sector -> "besonders wichtig" (>=250, Anlage 1)
   - 60 employees + Postal sector -> "wichtig" (>=50, any sector)
   - 10 employees + 5M revenue + Postal sector -> "nicht betroffen" (below all thresholds)
   - KRITIS checkbox checked + any sector/size -> "besonders wichtig"
7. Navigate to landing page, verify CTA links to /check
  </verify>
  <done>
- Result step shows color-coded classification card (red/orange/green) with icon and legal reference
- Expandable "Warum?" section with classification reasoning
- Supply chain hint for "nicht betroffen" results
- "Mein Sektor ist nicht aufgefuehrt" shortcut shows "nicht betroffen" with supply chain hint
- Balance sheet optional handling: omitted balance sheet passes Number.MAX_SAFE_INTEGER so revenue-only classification works correctly
- Special cases (DNS, TLD, qTSP, KRITIS) correctly classified as besonders-wichtig
- Both CTAs functional (Reifegrad pruefen links forward, Erneut pruefen resets)
- Landing page CTA links to /check
- All text internationalized (DE/EN)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete NIS2 Affected Check wizard with 3-step flow: sector selection, company size inputs, and classification result with legal references</what-built>
  <how-to-verify>
1. Open http://localhost:3000/de/check
2. Verify step indicator shows 3 steps with "Sektor" highlighted
3. Select "Energie" -> verify subsector dropdown appears with "Stromversorgung", "Fernwaerme", etc.
4. Select "Stromversorgung", click "Weiter"
5. Enter 300 employees, 60.000.000 EUR revenue
6. Click "Ergebnis anzeigen"
7. Verify: RED card showing "Besonders wichtige Einrichtung" with "Par. 28 Abs. 1 Nr. 4 BSIG"
8. Click "Warum?" -> verify expandable text shows explanation
9. Click "Erneut pruefen" -> verify reset to step 1

Test "nicht betroffen" path:
10. Select "Post- und Kurierdienste" (no subsector should appear)
11. Enter 10 employees, 500.000 EUR revenue
12. Click "Ergebnis anzeigen"
13. Verify: GREEN card showing "Nicht betroffen" with supply chain hint box below

Test shortcut path:
14. Click "Erneut pruefen", select "Mein Sektor ist nicht aufgefuehrt"
15. Verify: Jumps directly to GREEN result with supply chain hint (no company size step shown)

Test balance sheet optional (CRITICAL):
16. Click "Erneut pruefen", select "Post- und Kurierdienste"
17. Enter 10 employees, 15.000.000 EUR revenue, leave balance sheet EMPTY
18. Click "Ergebnis anzeigen"
19. Verify: ORANGE card showing "Wichtige Einrichtung" (15M > 10M threshold, balance sheet not blocking)

Test special case:
20. Click "Erneut pruefen", select "Digitale Infrastruktur" -> "DNS-Diensteanbieter"
21. Enter 5 employees, 100.000 EUR (tiny company)
22. Verify: RED card "Besonders wichtige Einrichtung" (DNS always qualifies)

23. Switch language to EN, verify all text switches to English
24. Verify landing page CTA button links to /check
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
**Phase 3 Requirements Check:**
- AFFECT-01: User kann Sektor aus allen 18 NIS2-Sektoren auswaehlen -> Grouped dropdown with all 14 sectors (7 Anlage 1 + 7 Anlage 2) plus subsectors
- AFFECT-02: User gibt Mitarbeiterzahl und Jahresumsatz ein -> NumericFormat inputs with thousand separators
- AFFECT-03: System klassifiziert korrekt -> classifyEntity() from Phase 2 wired to result display, with balance sheet optional handling
- AFFECT-04: Sonderfaelle korrekt behandelt -> DNS, TLD, qTSP via alwaysQualified, KRITIS via checkbox. Note: THRESHOLDS.besondersWichtig.telecom is defined in classification.ts but unused (dead code) -- no telecom sector exists in sectors.ts. Telco providers are covered under digital-infrastructure. This is a known limitation.
- AFFECT-05: Ergebnis zeigt Klassifizierung mit Begruendung und Gesetzesreferenz -> Color card + expandable "Warum?" + legal reference
- AFFECT-06: Bei "nicht betroffen": Lieferketten-Hinweis -> Yellow info box with Art. 21(2)(d) reference

**Technical Verification:**
- `npm run build` succeeds
- `npx tsc --noEmit` passes
- No hydration warnings in browser console
- Form data persists in localStorage across page refreshes
- All wizard text available in DE and EN
- Balance sheet = 0 (omitted) correctly maps to Number.MAX_SAFE_INTEGER before classifyEntity() call
</verification>

<success_criteria>
- Working 3-step wizard at /[locale]/check accessible from landing page CTA
- All 18 sectors selectable with correct Anlage grouping
- Progressive subsector disclosure works
- "Mein Sektor ist nicht aufgefuehrt" shortcut to nicht-betroffen result (skips company size step entirely)
- Number inputs with German thousand-separator formatting (1.000, 10.000.000)
- classifyEntity() produces correct results for all requirement cases
- Balance sheet optional: omitting balance sheet does NOT penalize classification (Number.MAX_SAFE_INTEGER used)
- Color-coded result card (red/orange/green) with icon + text + legal reference
- Expandable "Warum?" section with classification reasoning
- Supply chain hint for nicht-betroffen results
- Both CTAs functional (Reifegrad pruefen links forward, Erneut pruefen resets)
- Full DE/EN internationalization
- No hydration errors, form data persists in localStorage
- Form validation shows inline errors for required fields
</success_criteria>

<output>
After completion, create `.planning/phases/03-affected-check/03-02-SUMMARY.md`
</output>
