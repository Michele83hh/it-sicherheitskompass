---
phase: 05-results-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/app/[locale]/results/page.tsx
  - src/app/[locale]/results/components/disclaimer-banner.tsx
  - src/app/[locale]/results/components/overall-score-hero.tsx
  - src/app/[locale]/results/components/category-card.tsx
  - src/app/[locale]/results/components/quick-wins-section.tsx
  - src/app/[locale]/results/components/recommendations-section.tsx
autonomous: false

must_haves:
  truths:
    - "User sees disclaimer banner at top of results page before any scores"
    - "User sees overall Reifegrad score prominently at the top"
    - "All 10 categories display as traffic-light cards with percentage score bars"
    - "Category cards are sorted by severity (red first, then yellow, then green)"
    - "Each category card shows name, traffic light, percentage, verdict, and #1 recommendation"
    - "Quick Wins section shows 3-5 highest-impact quick-effort actions across all categories"
    - "All recommendations include legal reference inline and BSI building block link"
    - "Effort level tags (Schnell umsetzbar, Mittelfristig, Strategisch) appear on each recommendation"
    - "Retake button navigates to gap analysis; PDF button is disabled with coming-soon label"
    - "Page redirects to gap-analysis if assessment data is incomplete"
    - "Page renders correctly on mobile (single column) and desktop (3-column grid)"
  artifacts:
    - path: "src/app/[locale]/results/page.tsx"
      provides: "Main results page with hydration guard and route protection"
      min_lines: 60
    - path: "src/app/[locale]/results/components/disclaimer-banner.tsx"
      provides: "Prominent disclaimer banner component"
      min_lines: 15
    - path: "src/app/[locale]/results/components/overall-score-hero.tsx"
      provides: "Hero section with overall Reifegrad score and progress bar"
      min_lines: 30
    - path: "src/app/[locale]/results/components/category-card.tsx"
      provides: "Individual traffic-light category card with score bar"
      min_lines: 40
    - path: "src/app/[locale]/results/components/quick-wins-section.tsx"
      provides: "Quick wins section with 3-5 actionable items"
      min_lines: 30
    - path: "src/app/[locale]/results/components/recommendations-section.tsx"
      provides: "Full recommendations list sorted by severity"
      min_lines: 50
  key_links:
    - from: "src/app/[locale]/results/page.tsx"
      to: "src/stores/gap-analysis-store.ts"
      via: "useGapAnalysisStore for answers"
      pattern: "useGapAnalysisStore"
    - from: "src/app/[locale]/results/page.tsx"
      to: "src/lib/scoring/engine.ts"
      via: "calculateOverallScore for score computation"
      pattern: "calculateOverallScore"
    - from: "src/app/[locale]/results/page.tsx"
      to: "src/lib/nis2/recommendations.ts"
      via: "getRecommendationsByCategory for recommendations"
      pattern: "getRecommendationsByCategory"
    - from: "src/app/[locale]/results/components/category-card.tsx"
      to: "src/components/ui/progress.tsx"
      via: "Progress component for score bar"
      pattern: "import.*Progress"
    - from: "src/app/[locale]/results/components/quick-wins-section.tsx"
      to: "src/components/ui/badge.tsx"
      via: "Badge component for effort level tags"
      pattern: "import.*Badge"
---

<objective>
Build the complete results dashboard page displaying NIS2 readiness scores with traffic-light category cards, overall Reifegrad hero, quick wins section, full recommendations, and disclaimer banner.

Purpose: This is the final output users see after completing the gap analysis -- the payoff of the entire tool. It must clearly communicate their readiness level, highlight urgent gaps, and give actionable next steps. This directly satisfies requirements SCORE-02, SCORE-03, SCORE-04, SCORE-06.

Output: A fully functional results page at `/[locale]/results` with 5 sub-components, route protection, hydration guard, responsive layout, and WCAG-compliant traffic-light indicators.
</objective>

<execution_context>
@C:\Users\mjoan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\mjoan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-results-dashboard/05-CONTEXT.md
@.planning/phases/05-results-dashboard/05-RESEARCH.md
@.planning/phases/05-results-dashboard/05-01-SUMMARY.md

@src/lib/scoring/engine.ts
@src/lib/nis2/types.ts
@src/lib/nis2/categories.ts
@src/lib/nis2/questions.ts
@src/lib/nis2/recommendations.ts
@src/stores/gap-analysis-store.ts
@src/stores/wizard-store.ts
@src/app/[locale]/gap-analysis/page.tsx
@src/messages/de.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create results page and all dashboard components</name>
  <files>
    src/app/[locale]/results/page.tsx,
    src/app/[locale]/results/components/disclaimer-banner.tsx,
    src/app/[locale]/results/components/overall-score-hero.tsx,
    src/app/[locale]/results/components/category-card.tsx,
    src/app/[locale]/results/components/quick-wins-section.tsx,
    src/app/[locale]/results/components/recommendations-section.tsx
  </files>
  <action>
**1. Create `src/app/[locale]/results/page.tsx` (main results page)**

This is a `'use client'` component. Follow the exact pattern from `src/app/[locale]/gap-analysis/page.tsx` for the hydration guard.

Structure:
```
- isClient hydration guard with skeleton fallback (same pattern as gap-analysis page)
- Route guard: if answers.length < 30 (all questions), redirect to /gap-analysis using router.push
- Use useMemo to calculate scores from gap-analysis-store answers via calculateOverallScore()
- Use useMemo to build sorted category list (red -> yellow -> green)
- Use useMemo to derive quick wins (filter recommendations where category is red AND effortLevel is 'quick'; if fewer than 3, include yellow+quick; cap at 5)
- Layout: max-w-6xl mx-auto px-4 py-8 sm:py-12
- Render order: disclaimer banner -> overall score hero -> category cards grid -> quick wins -> recommendations -> action buttons
- Use next-intl useTranslations('results') for all text
- Use useTranslations('categories') for category names
- Use useTranslations('recommendations') for recommendation text
```

For the skeleton fallback, render matching layout structure with animate-pulse divs to minimize layout shift.

For locale-aware routing, read locale from useParams() like the gap-analysis page does. Use `/${locale}/gap-analysis` for redirect and retake links.

**2. Create `src/app/[locale]/results/components/disclaimer-banner.tsx`**

A prominent warning banner appearing BEFORE any scores. Use a yellow/amber background with AlertTriangle icon from lucide-react.

```
- Full-width banner with bg-amber-50 border border-amber-200 rounded-lg p-4
- AlertTriangle icon (lucide-react) on the left
- Text from t('disclaimer.text') -- uses conditional language per CONTEXT.md
- WCAG: include icon + text (not color alone)
```

**3. Create `src/app/[locale]/results/components/overall-score-hero.tsx`**

The hero section with the overall Reifegrad score displayed prominently.

Props: `overallScore: OverallScore` (from types.ts)

```
- Large percentage display (text-5xl font-bold)
- Text label "Gesamter Reifegrad" from t('overallScore.label')
- Traffic light indicator with icon + text label (same WCAG pattern: color + icon + text)
- Progress bar using shadcn/ui Progress component showing percentage
- Completion rate text: "{X}% der Fragen beantwortet"
- Qualitative verdict text based on traffic light color from t('verdict.red|yellow|green')
- Background: subtle card with padding, centered text
- Icons: CheckCircle2 for green, AlertTriangle for yellow, AlertCircle for red (all from lucide-react)
- Traffic light colors: text-red-600/bg-red-50, text-yellow-600/bg-yellow-50, text-green-600/bg-green-50
```

**4. Create `src/app/[locale]/results/components/category-card.tsx`**

Individual traffic-light category card. One card per NIS2 category.

Props: `categoryScore: CategoryScore`, `categoryName: string`, `categoryShortName: string`, `euArticle: string`, `bsigParagraph: string`, `verdict: string`, `topRecommendation: { title: string, firstStep: string, effortLevel: EffortLevel }`

```
- Use shadcn/ui Card (CardHeader, CardTitle, CardContent)
- Card header: category short name + traffic light icon badge (colored circle with icon)
- Score: percentage in text-2xl font-bold + Progress bar (colored by traffic light)
  - Progress bar color: use className override -- red: [&>div]:bg-red-500, yellow: [&>div]:bg-yellow-500, green: [&>div]:bg-green-500
- Legal reference: euArticle + bsigParagraph inline (text-xs text-muted-foreground)
- Verdict text: 1-line verdict from t('verdict.{color}')
- Top recommendation box: muted background, "Prioritaet #1" label, recommendation title, effort level Badge
- Traffic light icons: AlertCircle (red), AlertTriangle (yellow), CheckCircle2 (green)
- WCAG: traffic light uses color + icon + text label from t('trafficLight.red|yellow|green')
```

**5. Create `src/app/[locale]/results/components/quick-wins-section.tsx`**

Dedicated section highlighting 3-5 quick win recommendations.

Props: `quickWins: Array<{ recommendation: Recommendation, categoryName: string, categoryTrafficLight: TrafficLight }>`

```
- Section with heading from t('quickWins.title') and subheading
- Each quick win in a Card showing:
  - Category name badge (colored by traffic light)
  - Recommendation title from t(rec.titleKey)
  - First step from t(rec.firstStepKey) with label "Erster Schritt"
  - Effort level Badge (always "Schnell umsetzbar" since these are quick wins)
  - Legal reference inline (text-xs)
  - BSI reference as external link to BSI Kompendium URL
- BSI link URL: https://www.bsi.bund.de/DE/Themen/Unternehmen-und-Organisationen/Standards-und-Zertifizierung/IT-Grundschutz/IT-Grundschutz-Kompendium/it-grundschutz-kompendium_node.html
- Use ExternalLink icon (lucide-react) next to BSI links
- Responsive: grid-cols-1 on mobile, grid-cols-2 on md+
```

**6. Create `src/app/[locale]/results/components/recommendations-section.tsx`**

Full recommendations list, all 10 categories, sorted by severity (red first).

Props: `sortedCategories: Array<{ categoryScore: CategoryScore, categoryName: string, recommendations: Recommendation[] }>`

```
- Section heading from t('recommendations.title') and subtitle
- For each category (sorted red -> yellow -> green):
  - Category header with name, traffic light badge, percentage
  - Each recommendation in that category:
    - Title from t(rec.titleKey)
    - Description from t(rec.descriptionKey)
    - First step from t(rec.firstStepKey) with label
    - Effort level Badge using shadcn/ui Badge:
      - quick: green variant (bg-green-100 text-green-800)
      - medium: yellow variant (bg-yellow-100 text-yellow-800)
      - strategic: blue variant (bg-blue-100 text-blue-800)
    - Legal reference inline: rec.legalReference
    - BSI reference as clickable external link: "BSI {rec.bsiReference}" linking to BSI Kompendium
- Use Separator between categories
- Responsive: full width, stacked layout
```

**7. Action Buttons (in page.tsx, below recommendations)**

```
- Flexbox row with gap-4, centered
- "Gap-Analyse wiederholen" button: variant="outline", links to /{locale}/gap-analysis
  - On click, call gapAnalysisStore.reset() before navigating
- "PDF herunterladen" button: variant="default", DISABLED, with tooltip "Verfuegbar in Kuerze"
  - Use disabled attribute + opacity-50 styling
  - This button becomes active in Phase 6
```

**Critical implementation notes:**

1. **Hydration guard**: Must use isClient pattern. Without it, zustand persist causes hydration mismatch.

2. **Score calculation with useMemo**: Calculate ALL scores in the page component, pass down as props. Do NOT recalculate in child components.
```typescript
const overallScore = useMemo(() => {
  const categoryQuestionCounts = CATEGORIES.map(cat => ({
    categoryId: cat.id,
    totalQuestions: getQuestionsByCategory(cat.id).length
  }));
  return calculateOverallScore(answers, categoryQuestionCounts);
}, [answers]);
```

3. **Quick wins algorithm**: Filter all recommendations where the category has trafficLight === 'red' AND recommendation.effortLevel === 'quick'. If fewer than 3, also include yellow+quick. Sort by: red categories first, then high priority first. Cap at 5.

4. **Category name resolution**: Use `tCategories(category.nameKey.replace('categories.', ''))` pattern -- same as gap-analysis page does. For short names use `shortNameKey` similarly.

5. **Route guard**: Check `answers.length < 30` (10 categories x 3 questions = 30 required answers). If incomplete, redirect to `/${locale}/gap-analysis`. The route guard must run AFTER isClient is true (inside the client-side render branch).

6. **Recommendation text resolution**: Recommendation keys like `recommendations.ra1.title` need `useTranslations('recommendations')` and then `tRec('ra1.title')`. The key structure strips the `recommendations.` prefix.

7. **Do NOT** create a layout.tsx for the results route -- it inherits from `[locale]/layout.tsx` automatically.

8. **No new dependencies**: Use only existing installed packages. Badge and Progress from Plan 01.
  </action>
  <verify>
1. Run `npx tsc --noEmit` -- no type errors
2. Run `npm run dev` and navigate to `/de/results` -- page should redirect to gap-analysis (no data)
3. Complete the gap analysis wizard (answer all 30 questions), then navigate to results
4. Verify: disclaimer banner visible at top, overall score shown, 10 category cards displayed
5. Verify: cards sorted by traffic light color (red first)
6. Verify: quick wins section shows actionable items
7. Verify: "PDF herunterladen" button is disabled
8. Verify: responsive layout -- resize to mobile width, cards stack to single column
9. Run `npx vitest run` -- all existing tests still pass
  </verify>
  <done>
Results page renders at /[locale]/results with disclaimer, overall Reifegrad, 10 traffic-light category cards, quick wins section, full recommendations with legal+BSI refs, effort level badges, retake button, and disabled PDF button. Route guard redirects if no data. Responsive on mobile. All existing tests pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete NIS2 results dashboard with traffic-light category cards, overall Reifegrad score, quick wins section, prioritized recommendations with legal/BSI references, effort level tags, disclaimer banner, route protection, and responsive layout.</what-built>
  <how-to-verify>
1. Open http://localhost:3000/de/results in browser
   - Should redirect to gap-analysis (no data yet)
2. Go to http://localhost:3000/de/gap-analysis and complete all 10 categories
   - Try mix of answers: some level 0, some level 1-2, some level 3
   - After last category, click "Ergebnisse anzeigen"
3. On results page, verify from top to bottom:
   a. Disclaimer banner visible at top (amber background, warning text about Reifegrad != Konformitaet)
   b. Overall Reifegrad score displayed large with progress bar and traffic light
   c. Category cards in a grid (3 columns on desktop, 1 on mobile)
   d. Cards sorted: red categories first, then yellow, then green
   e. Each card shows: category name, traffic light icon+text, percentage, progress bar, verdict, top recommendation
   f. Quick Wins section with 3-5 actionable items
   g. Full recommendations section with all categories
   h. Each recommendation has: effort level badge, legal reference, BSI link
   i. "Gap-Analyse wiederholen" button works (navigates back)
   j. "PDF herunterladen" button is disabled with "coming soon" indicator
4. Resize browser to mobile width (~375px) -- cards stack, no horizontal overflow
5. Switch language to English -- all text translates correctly
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Phase 5 requirements verification:

- SCORE-02: Overall Readiness Score displayed as "Reifegrad" (not "Compliance Score") -- check overallScore.label translation key
- SCORE-03: All 10 categories with traffic-light cards and score bars -- check category grid renders 10 cards
- SCORE-04: Prioritized recommendations with Rot categories first -- check sort order in page.tsx
- SCORE-06: Disclaimer stating high score != automatic compliance -- check disclaimer banner text

Additional phase success criteria:
1. All 10 categories display as traffic-light cards (Rot/Gelb/Gruen) with percentage score bars
2. Overall Readiness Score shown as orientation value with explicit label "Reifegrad"
3. Recommendations sorted by priority (Rot categories first) with concrete next steps per category
4. Visible disclaimer states: high score does not automatically mean NIS2 conformity
</verification>

<success_criteria>
- Results page accessible at /[locale]/results
- Route guard redirects to gap-analysis when assessment incomplete
- Disclaimer banner appears BEFORE any scores (LOCKED decision)
- Overall Reifegrad score displayed in hero section (LOCKED decision)
- 10 category cards with traffic light + percentage + score bar + verdict + #1 recommendation
- Cards sorted by severity (red -> yellow -> green)
- Quick wins section with 3-5 high-impact, low-effort actions (LOCKED decision)
- All recommendations have effort level tags (LOCKED decision)
- Legal references inline, BSI references as external links (LOCKED decision)
- Retake button functional, PDF button disabled (LOCKED decision)
- Responsive layout (mobile single-column, desktop 3-column)
- WCAG: traffic light uses color + icon + text label (not color alone)
- All existing tests pass (zero regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/05-results-dashboard/05-02-SUMMARY.md`
</output>
